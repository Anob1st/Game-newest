<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiplayer Drawing Game - Lobby</title>
<style>
  body { font-family: Arial; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; background:#f0f0f0;}
  h1 { margin:20px 0;}
  #avatars { display:flex; gap:10px; margin-bottom:20px;}
  .avatar { border:2px solid gray; border-radius:50%; width:70px; height:70px; cursor:pointer; transition:0.2s;}
  .avatar.selected { border:3px solid #007bff;}
  #inputs { display:flex; flex-direction:column; align-items:center; gap:10px; margin-bottom:20px;}
  input[type=text] { padding:5px 10px; font-size:16px;}
  input[type=text]:focus { outline:2px solid #007bff;}
  button { padding:10px 20px; font-size:16px; margin:5px; cursor:pointer; background:#007bff; color:white; border:none; border-radius:5px; transition:0.2s;}
  button:hover { background:#0056b3;}
</style>
</head>
<body>
<h1>Multiplayer Drawing Game</h1>

<div id="inputs">
  <input type="text" id="playerName" placeholder="Enter your name">
  <input type="text" id="joinCode" placeholder="Room code (for joining)">
</div>

<div id="avatars">
  <img src="avatar1.png" class="avatar" data-avatar="avatar1.png">
  <img src="avatar2.png" class="avatar" data-avatar="avatar2.png">
  <img src="avatar3.png" class="avatar" data-avatar="avatar3.png">
  <img src="avatar4.png" class="avatar" data-avatar="avatar4.png">
  <img src="avatar5.png" class="avatar" data-avatar="avatar5.png">
</div>

<div id="buttons">
  <button id="createBtn">Create Room</button>
  <button id="joinBtn">Join Room</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

// ---------------- Firebase config ----------------
const firebaseConfig = {
  apiKey: "AIzaSyDyOnvm0qMvREjKgn12gN5QEml_AmodiRo",
  authDomain: "oooooo-ca089.firebaseapp.com",
  projectId: "oooooo-ca089",
  storageBucket: "oooooo-ca089.firebasestorage.app",
  messagingSenderId: "351774678518",
  appId: "1:351774678518:web:18511398dec45ece047bd7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------------- Avatar selection ----------------
let selectedAvatar = null;
document.querySelectorAll('.avatar').forEach(img=>{
  img.addEventListener('click', ()=>{
    document.querySelectorAll('.avatar').forEach(a=>a.classList.remove('selected'));
    img.classList.add('selected');
    selectedAvatar = img.dataset.avatar;
  });
});

// ---------------- Functions ----------------
window.createRoom = async function(){
  const name = document.getElementById("playerName").value.trim();
  if(!name || !selectedAvatar){ alert("Choose name and avatar"); return; }

  const roomCode = Math.random().toString(36).substr(2,5).toUpperCase();
  localStorage.setItem("playerName", name);
  localStorage.setItem("avatar", selectedAvatar);
  localStorage.setItem("roomCode", roomCode);

  await setDoc(doc(db,"rooms",roomCode),{
    players:[{name, avatar:selectedAvatar}],
    strokes: [],
    chat: []
  });

  window.location.href = "game.html";
}

window.joinRoom = async function(){
  const code = document.getElementById("joinCode").value.trim().toUpperCase();
  const name = document.getElementById("playerName").value.trim();
  if(!name || !selectedAvatar || !code){ alert("Fill all fields"); return; }

  const roomRef = doc(db,"rooms",code);
  const roomSnap = await getDoc(roomRef);
  if(!roomSnap.exists()){ alert("Room not found"); return; }

  await updateDoc(roomRef,{
    players: arrayUnion({name, avatar:selectedAvatar})
  });

  localStorage.setItem("playerName", name);
  localStorage.setItem("avatar", selectedAvatar);
  localStorage.setItem("roomCode", code);

  window.location.href = "game.html";
}

// ---------------- Buttons ----------------
document.getElementById("createBtn").addEventListener("click", createRoom);
document.getElementById("joinBtn").addEventListener("click", joinRoom);

</script>
</body>
</html>
