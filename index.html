<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiplayer Drawing Game</title>
<style>
  body { font-family: Arial; display: flex; flex-direction: column; align-items: center; background:#f0f0f0; margin:0; padding:20px;}
  h1 { margin-bottom: 10px;}
  #avatars { display: flex; gap: 10px; margin-bottom: 20px;}
  .avatar { border:2px solid gray; border-radius:50%; width:60px; height:60px; cursor:pointer; transition:0.2s;}
  .avatar.selected { border:3px solid #00f; }
  input[name="playerName"] { padding:5px; font-size:16px; margin-bottom:20px;}
  button { padding:10px 20px; margin:5px; font-size:16px; cursor:pointer;}
</style>
</head>
<body>

<h1>Multiplayer Drawing Game</h1>
<input type="text" id="playerName" placeholder="Enter your name" />

<div id="avatars">
  <img src="avatar1.png" class="avatar" data-avatar="avatar1.png">
  <img src="avatar2.png" class="avatar" data-avatar="avatar2.png">
  <img src="avatar3.png" class="avatar" data-avatar="avatar3.png">
  <img src="avatar4.png" class="avatar" data-avatar="avatar4.png">
  <img src="avatar5.png" class="avatar" data-avatar="avatar5.png">
</div>

<button onclick="createRoom()">Create Room</button>
<input type="text" id="joinCode" placeholder="Enter Room Code">
<button onclick="joinRoom()">Join Room</button>

<script type="module">
  // Firebase setup
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDyOnvm0qMvREjKgn12gN5QEml_AmodiRo",
    authDomain: "oooooo-ca089.firebaseapp.com",
    projectId: "oooooo-ca089",
    storageBucket: "oooooo-ca089.firebasestorage.app",
    messagingSenderId: "351774678518",
    appId: "1:351774678518:web:18511398dec45ece047bd7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let selectedAvatar = null;
  document.querySelectorAll('.avatar').forEach(img => {
    img.addEventListener('click', () => {
      document.querySelectorAll('.avatar').forEach(a=>a.classList.remove('selected'));
      img.classList.add('selected');
      selectedAvatar = img.dataset.avatar;
    });
  });

  function createRoom() {
    const name = document.getElementById("playerName").value.trim();
    if (!name || !selectedAvatar) { alert("Choose name and avatar"); return; }

    const roomCode = Math.random().toString(36).substr(2,5).toUpperCase();
    localStorage.setItem("playerName", name);
    localStorage.setItem("avatar", selectedAvatar);
    localStorage.setItem("roomCode", roomCode);

    // create room in Firestore
    setDoc(doc(db,"rooms",roomCode),{
      players: [{name, avatar:selectedAvatar}]
    }).then(()=>{
      window.location.href="game.html";
    }).catch(e=>alert("Firebase error: "+e));
  }

  async function joinRoom() {
    const code = document.getElementById("joinCode").value.trim().toUpperCase();
    const name = document.getElementById("playerName").value.trim();
    if (!name || !selectedAvatar || !code) { alert("Fill all fields"); return; }

    const roomRef = doc(db,"rooms",code);
    const roomSnap = await getDoc(roomRef);
    if (!roomSnap.exists()) { alert("Room not found"); return; }

    await updateDoc(roomRef,{
      players: arrayUnion({name, avatar:selectedAvatar})
    });

    localStorage.setItem("playerName", name);
    localStorage.setItem("avatar", selectedAvatar);
    localStorage.setItem("roomCode", code);
    window.location.href="game.html";
  }

</script>
</body>
</html>
