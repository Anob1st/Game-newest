<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drawing Room</title>
<style>
body { margin:0; font-family: Arial; background:#f8f8f8; display:flex; flex-direction:column; align-items:center;}
#players { display:flex; gap:10px; margin:10px;}
.player { display:flex; flex-direction:column; align-items:center;}
canvas { border:2px solid #000; margin-top:10px; background:white; }
#tools { margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;}
button { padding:5px 10px; font-size:14px; margin:3px;}
#chat { margin-top:10px; width:800px; max-width:90%; display:flex; gap:5px;}
#chatMessages { flex:1; border:1px solid #aaa; padding:5px; height:100px; overflow-y:auto; background:#fff;}
</style>
</head>
<body>

<div id="players"></div>

<canvas id="canvas" width="800" height="600"></canvas>

<div id="tools">
  <button id="undo">Undo</button>
  <button id="clear">Clear</button>
  <input type="color" id="color" value="#000000">
  <input type="range" id="brush" min="1" max="15" value="3">
</div>

<div id="chat">
  <div id="chatMessages"></div>
  <input type="text" id="chatInput" placeholder="Type message">
  <button id="sendChat">Send</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

// ---------------- Firebase ----------------
const firebaseConfig = {
  apiKey: "AIzaSyDyOnvm0qMvREjKgn12gN5QEml_AmodiRo",
  authDomain: "oooooo-ca089.firebaseapp.com",
  projectId: "oooooo-ca089",
  storageBucket: "oooooo-ca089.firebasestorage.app",
  messagingSenderId: "351774678518",
  appId: "1:351774678518:web:18511398dec45ece047bd7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------------- Player Info ----------------
const playerName = localStorage.getItem("playerName");
const avatar = localStorage.getItem("avatar");
const roomCode = localStorage.getItem("roomCode");
const roomRef = doc(db,"rooms",roomCode);

// ---------------- Players UI ----------------
const playersDiv = document.getElementById("players");
onSnapshot(roomRef, snap=>{
  const data = snap.data();
  if(data && data.players){
    playersDiv.innerHTML = "";
    data.players.forEach(p=>{
      const div = document.createElement("div");
      div.className="player";
      div.innerHTML=`<img src="${p.avatar}" width="50"><span>${p.name}</span>`;
      playersDiv.appendChild(div);
    });
  }
});

// ---------------- Canvas ----------------
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let drawing=false, lastX=0, lastY=0;
let brushColor=document.getElementById("color").value;
let brushSize=document.getElementById("brush").value;

document.getElementById("color").addEventListener("input", e=>brushColor=e.target.value);
document.getElementById("brush").addEventListener("input", e=>brushSize=e.target.value);

canvas.addEventListener("mousedown", e=>{drawing=true; lastX=e.offsetX; lastY=e.offsetY;});
canvas.addEventListener("mouseup", e=>drawing=false);
canvas.addEventListener("mouseout", e=>drawing=false);
canvas.addEventListener("mousemove", draw);

async function draw(e){
  if(!drawing) return;
  const x=e.offset
